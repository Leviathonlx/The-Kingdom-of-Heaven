duel_end_effect = {
	if = {
		limit = {scope:duel_for_prestige = yes}
		$VICTOR$ = {add_prestige = {value = 100 if = {limit = {scope:duel_for_prestige = yes} multiply = 5}}}
		$LOSER$ = {add_prestige = {value = -100 if = {limit = {scope:duel_for_prestige = yes} multiply = 5}}}
	}
	if = {
		limit = {scope:duel_for_artifacts = yes}
		#$VICTOR$ = {add_prestige = 100}
		transfer_random_artifact = { A = $LOSER$ B = $VICTOR$ }	
	}
	if = {
		limit = {scope:duel_for_land = yes}
		#$VICTOR$ = {add_prestige = 100}
		$LOSER$ = {
			#add_prestige = -100
			create_title_and_vassal_change = {
				type = conquest
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			if = {
				limit = {
					any_held_title = {
						tier = tier_county
						any_neighboring_county = { holder = $VICTOR$ }
					}
				}
				random_held_title = {
					limit = {
						any_neighboring_county = { holder = $VICTOR$ }
						tier = tier_county
					}
					change_title_holder = {
						holder = $VICTOR$
						change = scope:title_change
					}
				}
			}
			else = {
				random_held_title = {
					limit = {
						tier = tier_county
					}
					change_title_holder = {
						holder = $VICTOR$
						change = scope:title_change
					}
				}
			}
			resolve_title_and_vassal_change = scope:title_change
		}
	}
	$VICTOR$ = {duel_realize_wounds = {KILLER = $LOSER$}}
	$LOSER$ = {duel_realize_wounds = {KILLER = $VICTOR$}}  
}
duel_realize_wounds = {
	if = {
		limit = {
			exists = var:duel_damage
		}
		switch = {
			trigger = var:duel_damage
			flag:duel_wound = {add_trait = wounded_1}
			flag:duel_serious_wound = {add_trait = wounded_2}
			flag:duel_one_legged = {add_trait = one_legged}
			flag:duel_one_eyed = {add_trait = one_eyed}
			flag:duel_disfigured = {add_trait = disfigured}
			flag:duel_death = {death = {death_reason = death_duel killer = $KILLER$}}
		}
		remove_variable = duel_damage
	}
}
dueling_roll_for_wounds = {
	hidden_effect = {
	random_list = {
		40 = {
			set_variable = {name = duel_damage value = flag:duel_wound}
		}
		30 = {
			set_variable = {name = duel_damage value = flag:duel_serious_wound}
		}
		10 = {
			set_variable = {name = duel_damage value = flag:duel_one_legged}
		}
		10 = {
			set_variable = {name = duel_damage value = flag:duel_one_eyed}
		}
		9 = {
			set_variable = {name = duel_damage value = flag:duel_disfigured}
		}
		1 = {
			set_variable = {name = duel_damage value = flag:duel_death}
		}
	}
}
}
dueling_roll_for_wounds_stonestance = {
	hidden_effect = {
	random_list = {
		50 = {set_variable = {name = saved_by_stonestance}}
		40 = {
			set_variable = {name = duel_damage value = flag:duel_wound}
		}
		30 = {
			set_variable = {name = duel_damage value = flag:duel_serious_wound}
		}
		10 = {
			set_variable = {name = duel_damage value = flag:duel_one_legged}
		}
		10 = {
			set_variable = {name = duel_damage value = flag:duel_one_eyed}
		}
		9 = {
			set_variable = {name = duel_damage value = flag:duel_disfigured}
		}
		1 = {
			set_variable = {name = duel_damage value = flag:duel_death}
		}
	}
}
}

dueling_roll_for_wounds_bloodstance = {
	hidden_effect = {
	random_list = {
		10 = {
			set_variable = {name = duel_damage value = flag:duel_wound}
		}
		25 = {
			set_variable = {name = duel_damage value = flag:duel_serious_wound}
		}
		15 = {
			set_variable = {name = duel_damage value = flag:duel_one_legged}
		}
		15 = {
			set_variable = {name = duel_damage value = flag:duel_one_eyed}
		}
		13 = {
			set_variable = {name = duel_damage value = flag:duel_disfigured}
		}
		2 = {
			set_variable = {name = duel_damage value = flag:duel_death}
		}
	}
}
}

dueling_effect = {
	$ATTACKER$ = {
		duel = {
			skill = prowess
			target = $DEFENDER$
			10 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = -19
				}
				modifier = {
					add = 20
					$ATTACKER$ = {
						has_trait = duelist
					}
				}
				dueling_stance_attacker_modifier = {
					ATTACKER = $ATTACKER$
					DEFENDER = $DEFENDER$
				}
				$DEFENDER$ = {
					if = {
						limit = {exists = var:dueling_stance var:dueling_stance = flag:bloodstance}
						dueling_roll_for_wounds_bloodstance = yes
					}
					else_if = {
						limit = {exists = var:dueling_stance var:dueling_stance = flag:stonestance}
						dueling_roll_for_wounds_stonestance = yes
					}
					else = {
						dueling_roll_for_wounds = yes
					}
					trigger_event = WoK_duels.2012 # Defeat
				}
				$ATTACKER$ = {
					if = {
						limit = {exists = var:dueling_stance var:dueling_stance = flag:bloodstance}
						dueling_roll_for_wounds = yes
					}
					trigger_event = WoK_duels.1011 #Victory
				}
			}
			10 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -19
				}
				modifier = {
					add = 20
					$DEFENDER$ = {
						has_trait = duelist
					}
				}
				dueling_stance_defender_modifier = {
					DEFENDER = $DEFENDER$
				}
				$ATTACKER$ = {
					if = {
						limit = {exists = var:dueling_stance var:dueling_stance = flag:bloodstance}
						dueling_roll_for_wounds_bloodstance = yes
					}
					else_if = {
						limit = {exists = var:dueling_stance var:dueling_stance = flag:stonestance}
						dueling_roll_for_wounds_stonestance = yes
					}
					else = {
						dueling_roll_for_wounds = yes
					}
					trigger_event = WoK_duels.1012 #Defeat
				}
				$DEFENDER$ = {
					if = {
						limit = {exists = var:dueling_stance var:dueling_stance = flag:bloodstance}
						dueling_roll_for_wounds = yes
					}
					trigger_event = WoK_duels.2011 #Victory
				}
			}
		}
	}
}
set_dueling_stance = {#STANCE = string
	set_variable = {name = dueling_stance value = flag:$STANCE$ months = 1}
}
clear_dueling_variables = {#$ATTACKER$ $DEFENDER$
	$ATTACKER$ = {
		remove_variable = dueling_stance
	}
	$DEFENDER$ = {
		remove_variable = dueling_stance
	}
}
gain_twenty_battles = {
	change_variable = {
		name = battles_fought
		add = 20
	}
}