namespace = KOH_guelphs_ghibellines


KOH_guelphs_ghibellines.1 = { #forming a league
	title = KOH_guelphs_ghibellines.1.t
	desc = KOH_guelphs_ghibellines.1.desc
	theme = unfriendly
	left_portrait = {
		character = this
	}

	trigger = {		
		highest_held_title_tier = tier_duchy
		NOT = { exists = title:k_italy.holder }
		NOT = { has_global_variable = LombardLeague}  
		exists = title:e_hre.holder
		OR = {
		    has_title = title:c_lombardia
		    has_title = title:c_brescia
		    has_title = title:c_como
		    has_title = title:c_pavia
		    has_title = title:c_cremona
		    has_title = title:c_parma
		    has_title = title:c_piacenza
		    has_title = title:c_genoa
		    has_title = title:c_modena
		    has_title = title:c_reggio_emilia
		    has_title = title:c_canavese
		    has_title = title:c_mantua
		    has_title = title:c_venezia
		    has_title = title:c_treviso
		    has_title = title:c_verona
		    has_title = title:c_padova
		}
		OR = {
		    has_trait = ambitious
			has_trait = zealous
			has_trait = KOH_guelph
		    faith = {
				religious_head = { reverse_opinion = { target = ROOT value = 50 } }
			}
		}
		has_culture = culture:italian
		has_religion = religion:christianity_religion

		liege = {
		    has_title = title:e_hre
			primary_title = {
				OR = {
					has_realm_law = crown_authority_2
					has_realm_law = crown_authority_3
					has_realm_law = crown_authority_4
				}
			}
			NOT = {
			    any_character_war = {
					primary_defender = title:e_hre.holder
					using_cb = liberty_faction_war
				}
			}
		}
	}

	immediate = {
		set_global_variable = {
			name = LombardLeague
			value = yes
		}

		ROOT = { save_scope_as = ruler }
	}

	option = { 
		name = KOH_guelphs_ghibellines.1.a

		add_prestige = 200
		add_piety = 100
		hidden_effect = {
			create_dynamic_title = {
				tier = empire
				name = "Lombard League"
			}
			create_title_and_vassal_change = {
				type = conquest
				save_scope_as = change
				add_claim_on_loss = no
			}
			scope:new_title = {
				set_capital_county = scope:peasant_county
				generate_coa = yes
				set_landless_title = yes
				set_destroy_on_succession = yes
				set_delete_on_destroy = yes
				set_no_automatic_claims = yes
				set_definitive_form = yes
				set_can_be_named_after_dynasty = no
				change_title_holder = {
					holder = root
					change = scope:change
				}
			}

			scope:new_title.holder = { save_scope_as = ruler } 

			resolve_title_and_vassal_change = scope:change




			title:e_hre.holder = {
				trigger_event = {
					id = KOH_guelphs_ghibellines.2
					days = 1
				}
			}
			
			every_ruler = {
				limit = {
					has_culture_group = culture_group:latin_group
					NOT = {
						has_trait = KOH_ghibelline
					}
					OR = {
						has_trait = KOH_guelph
						has_title = title:c_lombardia
						has_title = title:c_brescia
						has_title = title:c_como
						has_title = title:c_pavia
						has_title = title:c_cremona
						has_title = title:c_parma
						has_title = title:c_piacenza
						has_title = title:c_genoa
						has_title = title:c_modena
						has_title = title:c_reggio_emilia
						has_title = title:c_canavese
						has_title = title:c_mantua
						has_title = title:c_venezia
						has_title = title:c_treviso
						has_title = title:c_verona
						has_title = title:c_padova
					}
				}
				trigger_event = {
					id = KOH_guelphs_ghibellines.3
					days = {5 15}
				}
			}
		}
		
		ai_chance = {
			base = 100
		}
	}
	option = { 
		name = KOH_guelphs_ghibellines.1.b
	}
}

KOH_guelphs_ghibellines.2 = { #HRE Reacts
	title = KOH_guelphs_ghibellines.2.t
	desc = KOH_guelphs_ghibellines.2.desc
	theme = unfriendly
	left_portrait = {
		character = this
	}

	option = { 
		name = KOH_guelphs_ghibellines.2.a
		
		ai_chance = {
			base = 100
		}
	}
	option = { 
		name = KOH_guelphs_ghibellines.2.b
	}
}

KOH_guelphs_ghibellines.3 = { #Join?
	title = KOH_guelphs_ghibellines.3.t
	desc = KOH_guelphs_ghibellines.3.desc
	theme = unfriendly
	left_portrait = {
		character = this
	}

	option = { 
		name = KOH_guelphs_ghibellines.3.a
		

		create_title_and_vassal_change = {
			type = swear_fealty  #or whatever
			save_scope_as = change
		}
		
		change_liege = {
			liege = scope:ruler
			change = scope:change
		}
		resolve_title_and_vassal_change = scope:change

		vassal_contract_set_obligation_level = { type = feudal_government_taxes level = 3 }

		ai_chance = {
			base = 100
		}
	}
	option = { 
		name = KOH_guelphs_ghibellines.3.b
	}
}

KOH_guelphs_ghibellines.4 = { #Join?
	title = KOH_guelphs_ghibellines.4.t
	desc = KOH_guelphs_ghibellines.4.desc
	theme = unfriendly
	left_portrait = {
		character = this
	}

	option = { 
		name = KOH_guelphs_ghibellines.4.a
		

	
	}
	option = { 
		name = KOH_guelphs_ghibellines.4.b
	}
}
